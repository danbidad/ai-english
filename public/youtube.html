<!DOCTYPE html>
<html lang="ko" ng-app="youtubeApp">

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>유튜브 자막 플레이어</title>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular-cookies.min.js"></script>
	<script src="https://www.youtube.com/iframe_api"></script>
	<script src="common.js"></script>
	<script src="youtube.html.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link rel="stylesheet" href="youtube.html.css">
</head>

<body ng-controller="YoutubeController">

<!-- 패널 오버레이 -->
<div class="dialog-overlay" onclick="closeOptionDialog()">></div>
<!-- 패널 대화상자 -->
<div class="dialog" id="optionDialog">
	<div class="dialog-close" onclick="closeOptionDialog()">×</div>
	<h3>언어 설정</h3>
	<div class="mb-3">
		<label for="subtitleLang1" class="form-label">자막언어1</label>
		<select id="subtitleLang1" ng-model="subtitleLang1" class="form-select" ng-options="option.id as option.name for option in subtitleLangs">
		</select>
	</div>
	<div class="mb-3">
		<label for="subtitleLang2" class="form-label">자막언어2</label>
		<select id="subtitleLang2" ng-model="subtitleLang2" class="form-select" ng-options="option.id as option.name for option in subtitleLangs">
		</select>
	</div>
	<button class="btn btn-success mt-3" ng-click="saveOptions()">저장</button>
</div>

<div id="page">
	{{ subtitleLang1 }}
	<div id="panel1">
		<div class="video-container">
			<div class="video-wrapper">
				<div id="player"></div>
				<div class="current-subtitle-overlay" ng-if="subtitle1" ng-class="{'empty': !subtitle1}">
                <span style="margin-right: 5px;" ng-repeat="word in splitWords(subtitle1.text) track by $index"
											class="word"
											ng-click="showWordMeaning($event, word)">{{ word }}</span>&nbsp;
				</div>
			</div>
		</div>

		<div class="subtitles-container" ng-if="subtitles1 && subtitles1.length">
			<div ng-repeat="subtitle in subtitles1 track by $index"
					 class="subtitle-item"
					 ng-class="{'active': isCurrentSubtitle(subtitle)}"
					 id="subtitle-{{$index}}">
				<div class="subtitle-header">
					<div class="subtitle-time">{{ formatTime(subtitle.start) }} - {{ formatTime(subtitle.dur) }}</div>
					<div class="icon-group">
						<i class="fas fa-volume-up seek-icon"
							 ng-if="isSpeechSupported"
							 ng-click="playTTS(subtitle.text, $event, $index)"
							 title="텍스트를 음성으로 읽기"></i>
						<i class="fas fa-play-circle seek-icon"
							 ng-click="seekToTime(subtitle.start)"
							 title="이 시간으로 이동"></i>
					</div>
				</div>
				<div class="subtitle-text">
					{{ subtitle.text }}
				</div>
			</div>
		</div>
	</div>
	<div id="panel2">
		<div class="subtitles-container2" ng-if="subtitles2 && subtitles2.length">
			<div ng-repeat="subtitle in subtitles2 track by $index"
					 class="subtitle-item"
					 ng-class="{'active': isCurrentSubtitle(subtitle)}"
					 id="subtitle-{{$index}}">
				<div class="subtitle-header">
					<div class="subtitle-time">{{ formatTime(subtitle.start) }} - {{ formatTime(subtitle.dur) }}</div>
					<div class="icon-group">
						<i class="fas fa-volume-up seek-icon"
							 ng-if="isSpeechSupported"
							 ng-click="playTTS(subtitle.text, $event, $index)"
							 title="텍스트를 음성으로 읽기"></i>
						<i class="fas fa-play-circle seek-icon"
							 ng-click="seekToTime(subtitle.start)"
							 title="이 시간으로 이동"></i>
					</div>
				</div>
				<div class="subtitle-text">
					{{ subtitle.text }}
				</div>
			</div>
		</div>
	</div>

	<div id="controlBar">
		<div class="current-time">{{ currentTime | formatDuration }}</div>
		<div class="control-button">
			<i class="bi bi-skip-backward-fill"></i>
		</div>
		<div class="control-button" ng-click="togglePlay()">
			<i class="bi bi-play-fill" ng-show="!isPlaying"></i>
			<i class="bi bi-stop-fill" ng-show="isPlaying"></i>
		</div>
		<div class="control-button">
			<i class="bi bi-skip-forward-fill"></i>
		</div>
		<div class="control-button">
			<i class="bi bi-arrow-clockwise"></i>
		</div>
		<div class="control-button" onclick="openOptionDialog()">
			<i class="bi bi-gear"></i>
		</div>
	</div>
</div>
<div class="word-popup" ng-if="selectedWord" ng-style="popupStyle" ng-if="wordMeanings">
	<div class="meaning" ng-repeat="meaning in wordMeanings">
		<span class="pos">{{ meaning.pos }}.</span> {{ meaning.definitions[0].definition }}
	</div>
</div>
</body>

</html>

<script>
	// 요소 가져오기
	const dialog = document.getElementById('optionDialog');
	const dialogOverlay = document.getElementsByClassName('dialog-overlay');
	const saveOptionsBtn = document.getElementById('saveOptionsBtn');

	// 패널 열기
	function openOptionDialog() {
		dialog.style.display = 'block';
		dialogOverlay[0].style.display = 'block';
	};

	// 패널 닫기 함수
	function closeOptionDialog() {
		dialog.style.display = 'none';
		dialogOverlay[0].style.display = 'none';
	}
</script>
<style>
</style>
